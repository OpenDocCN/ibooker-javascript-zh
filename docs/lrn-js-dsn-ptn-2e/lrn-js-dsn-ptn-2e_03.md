# 第三章：结构化和编写模式

新想法的成功取决于其效用以及您向试图帮助的人们展示它的方式。开发人员要理解和采用设计模式，必须提供有关上下文、情况、先决条件和重要示例的相关信息。本章适用于试图理解特定模式的人以及试图引入新模式的人，因为它提供了有关模式如何结构化和编写的基本信息。

# 设计模式的结构

如果模式作者无法定义其目的，他们将无法成功创建和发布模式。同样，如果开发人员没有背景或上下文，理解或实现模式将是具有挑战性的。

模式作者必须概述新模式的设计、实现和目的。作者最初以建立关系的*规则*形式呈现新模式，关系是：

+   一个背景

+   在这个背景中产生的一套力量系统

+   允许这些力量在上下文中解决的配置

有了这些，现在让我们总结设计模式的组成要素。设计模式应具有以下元素，其中前五个元素最为重要：

模式名称

代表模式目的的唯一名称。

描述

模式帮助实现的简要描述。

背景概述

模式有效响应其用户需求的背景。

问题陈述

解释模式意图的问题陈述。

解决方案

描述用户问题如何通过一系列步骤和感知解决的说明清单。

设计

模式设计的描述，特别是用户与之交互时的行为。

实施

开发人员如何实现该模式的指南。

插图

模式中类的视觉表示（例如，图表）。

示例

模式在最小形式下的实现。

共需条件

支持正在描述的模式使用可能需要什么其他模式？

关系

这种模式与哪些模式类似？是否与其他模式非常相似？

已知用途

该模式是否在实际中使用？如果是，是在哪里和如何使用？

讨论

团队或作者对模式激动人心的好处的思考。

# 优秀的模式

理解设计模式的结构和目的可以帮助我们更深入地理解为何需要该模式的推理。它还帮助我们评估我们自己需求的模式。

一个好的模式理想情况下应为最终用户提供大量参考资料。模式还应提供为何必要的证据。

仅仅了解一个模式的概述并不足以帮助我们在日常可能遇到的代码中识别它们。我们不总是清楚我们正在查看的代码是否遵循一组模式或偶然类似于其中一个。

如果你怀疑你看到的代码使用了某种模式，请考虑写下一些代码中属于特定现有模式或一组模式的一些方面。也许代码遵循了与特定模式规则巧合重叠的良好原则和设计实践。

###### 提示

在其中既没有交互也没有定义规则的解决方案不是模式。

尽管模式在规划和撰写阶段可能具有较高的初始成本，但从该投资中获得的价值可能是值得的。模式有价值，因为它们有助于在组织或团队中的所有开发人员在创建或维护解决方案时保持一致。如果您考虑要自己开发一个模式，请事先进行研究，因为您可能会发现使用或扩展现有的经过验证的模式比从头开始更有益。

# 撰写模式

如果您试图自己开发设计模式，我建议向那些已经经历并做得很好的人学习。花时间吸收来自几种不同设计模式描述的信息，并吸收对您有意义的内容。探索结构和语义——您可以通过检查您感兴趣的模式的交互和上下文来做到这一点，以识别有助于将这些模式组织在有价值的配置中的原则。

您可以利用*现有*格式编写自己的模式，或者看看是否有改进的方法，通过整合您的想法。近年来做到这一点的开发人员的一个例子是克里斯蒂安·海尔曼（Christian Heilmann），他采用了现有的*模块*模式（参见图 7-2）并对其进行了一些根本有价值的改变，以创建*揭示模块*模式（参见“揭示模块模式”）。

遵循以下清单将有助于您如果有兴趣创建新的设计模式或调整现有模式：

这种模式有多实用？

确保模式描述的是经过验证的解决方案，而不仅仅是尚未经过验证的推测性解决方案。

牢记最佳实践。

我们的设计决策应基于我们从理解最佳实践中得出的原则。

我们的设计模式应对用户透明。

设计模式应该对最终用户体验完全透明。它们主要为使用它们的开发人员提供服务，不应强制改变预期的用户体验。

记住，在模式设计中，原创性*不是*关键。

在撰写模式时，你无需成为记录解决方案的原始发现者，也不必担心你的设计与其他模式的次要部分重叠。如果这种方法足够强大，可以广泛应用，那么它有可能被认可为有效的模式。

模式需要一个强大的示例集。

一个好的模式描述需要跟随同样有效的示例集，展示模式成功应用的例子。为了展示广泛的使用，展现出良好设计原则的例子是理想的选择。

撰写模式是在创建通用、具体且最重要的是有用的设计之间进行谨慎平衡。在撰写模式时，尽量确保全面覆盖所有可能的应用领域。

无论你是否撰写模式，我希望这个对模式撰写的简要介绍能够为你提供一些见解，帮助你理解本书后续章节涵盖的模式。

# 总结

本章描绘了理想的“好”模式的图景。同样重要的是要理解，“坏”模式也存在，因此我们需要识别并避免它们。这就是为什么我们要在下一章讨论“反模式”的原因。
