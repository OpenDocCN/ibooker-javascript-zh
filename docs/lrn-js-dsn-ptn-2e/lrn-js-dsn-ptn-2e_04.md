# 第四章：反模式

作为工程师，我们可能会遇到我们必须在最后期限前交付解决方案或者代码被连续打补丁而没有进行代码审查的情况。在这些情况下的代码可能不总是经过深思熟虑，并且可能会传播我们所称的 *反模式* 。本章描述了什么是反模式以及理解和识别它们的重要性。我们还将看一些 JavaScript 中典型的反模式。

# 什么是反模式？

如果一个模式代表最佳实践，那么反模式则代表了当提议的模式走错路时所学到的教训。受 GoF 的书籍 *设计模式* 启发，安德鲁·科尼格于 1995 年在他在 [*面向对象编程杂志*，第 8 卷](https://oreil.ly/Megyr) 中的文章中首次创造了反模式一词。他描述反模式如下：

> 反模式就像模式一样，只不过它不是解决方案，而是看似是解决方案但实际上不是解决方案。

他提出了两种反模式的概念。反模式：

+   描述一个 *糟糕的* 解决方案导致发生了不利情况

+   描述 *如何* 从当前情况中脱身并找到一个好的解决方案。

在这个话题上，亚历山大写道在实现良好设计结构和良好上下文之间取得良好平衡方面的困难：

> 这些笔记讨论的是设计的过程；是发明物理事物的过程，这些事物在响应功能时展示了新的物理秩序、组织、形式。...每个设计问题都始于努力实现两个实体之间的适配：问题中的形式和它的上下文。上下文定义了问题，形式是问题的解决方案。

理解反模式和了解设计模式一样重要。让我们分析其背后的原因。在创建应用程序时，项目的生命周期从构建开始。在这个阶段，您可能会根据需要选择可用的 *良好* 设计模式。但是，在初始发布后，应用程序需要进行维护。

已经在生产中的应用程序的维护可能特别具有挑战性。之前没有参与过该应用程序开发的开发人员可能会在项目中意外引入一个 *糟糕的* 设计。如果这些 *糟糕的* 实践已被确认为反模式，开发人员将能够提前识别并避免已知的常见错误。这类似于设计模式的知识使我们能够识别我们可以应用 *已知* 和 *有用* 的标准技术的领域。

随着解决方案的演变，其质量将取决于团队投入的技能水平和时间，可能是 *好的* 或 *坏的* 。在这里，*好的* 和 *坏的* 是根据上下文来考虑的——一个“完美”的设计如果在错误的上下文中应用，可能会被视为反模式。

总结一下，反模式是值得记录的糟糕设计。

# JavaScript 中的反模式

开发人员有时会明知故犯地选择捷径和临时解决方案以加快代码交付速度。这些往往会变成永久性问题，并积累为技术债务，其本质上由反模式组成。JavaScript 是一种弱类型或无类型语言，这使得采取某些捷径更容易。以下是您可能在 JavaScript 中遇到的一些反模式示例：

+   通过在全局上下文中定义大量变量来污染全局命名空间。

+   将字符串而非函数传递给`setTimeout`或`setInterval`，因为这会在内部触发`eval()`的使用。

+   修改`Object`类原型（这是一个特别糟糕的反模式）。

+   在行内形式中使用 JavaScript 是不灵活的。

+   在这里使用`document.write`，而原生文档对象模型（DOM）的替代方法如`document.createElement`更合适。多年来`document.write`被严重误用，并有许多缺点。如果在页面加载后执行，它可能会覆盖当前页面，因此选择`document.createElement`要明智得多。访问[此链接](https://oreil.ly/kc1c0)查看其实际应用的实时示例。它也不适用于 XHTML，这是选择更友好的 DOM 方法如`document.createElement`的另一个原因。

熟悉反模式对于成功至关重要。一旦我们学会识别这些反模式，就可以重构代码以消除它们，从而立即提高解决方案的整体质量。

# 总结

本章介绍了可能导致问题的模式，即反模式以及 JavaScript 反模式的示例。在详细讨论 JavaScript 设计模式之前，我们必须简要介绍一些关键的现代 JavaScript 概念，这些概念对我们关于模式讨论具有重要意义。这是下一章的主题，介绍了现代 JavaScript 的特性和语法。
