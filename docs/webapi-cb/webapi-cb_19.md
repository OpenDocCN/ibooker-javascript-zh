# 第十九章：总结思考

# 介绍

希望您发现本书中涵盖的示例和 API 对您有所帮助并且有趣。希望您能够将在本书中学到的内容应用于提升您的 JavaScript 应用程序。

# 为第三方库辩护

本书的主要主题之一是，在不需要第三方库的情况下，您可以做很多事情。这是事实，但不要觉得必须以不使用第三方库为代价。有时使用内置的浏览器 API 可以避免依赖性，但您可能需要编写额外的“粘合”代码以使其适应您要完成的任务。

有些浏览器 API 可能难以处理。以 IndexedDB API 为例，它是一个强大的数据持久化和访问层，但其 API 基于回调，可能让人感到棘手。有些库封装了 IndexedDB 并提供了更简单或更强大的 API。例如，Dexie.js 使用基于`Promise`的 API 封装了 IndexedDB。

最终，一切都是一种权衡。如果在 JavaScript 包中有多余的空间来提供更简单的开发者体验，那可能是值得的。

# 检测特性，而非浏览器版本

如果您需要检查用户是否在支持您想要使用的 API 的浏览器上运行，您可能会考虑查看用户代理字符串，并确定用户的浏览器版本。尽量避免这样做。这种方法极不可靠，而且轻而易举地伪装用户代理字符串以冒充其他浏览器。

反之，检测特定功能是否可用。例如，如果您想检查浏览器是否支持 IndexedDB，只需检查`window`对象中是否存在`indexedDB`属性（参见示例 19-1）。

##### 示例 19-1\. 检查 IndexedDB 支持

```
if ('indexedDB' in window) {
  // IndexedDB is supported!
}
```

# Polyfills

如果您需要支持旧版浏览器，可能仍然可以使用某些 API 的 polyfill。这是一个第三方 JavaScript 库，用于添加缺失的功能。这些 polyfill 可能不如内置 API 效率高，但它们允许您在其他情况下不支持的浏览器中使用新的 API。

当然，有些 API 无法进行 polyfill，因为它们依赖于与加速计或地理位置等本机设备能力的集成。如果浏览器无法与这些系统服务通信，任何第三方代码都无法弥补这一差距。

# 展望未来

未来可能会有更多令人兴奋的 API 出现，进一步扩展基于浏览器的应用程序的功能，而无需插件或第三方库。本节简要介绍了一些即将推出的实验性 API。

## Web Bluetooth API

不久后，您将能够使用 Web 蓝牙 API 在浏览器中原生地与蓝牙设备交互。它提供了基于`Promise`的接口，用于发现和读取连接的蓝牙设备的信息。您可以读取诸如电池电量之类的数据，或者监听来自设备的通知。

这通过与设备的 GATT（通用属性）配置文件进行交互来实现，该配置文件定义了蓝牙设备支持的服务和特性。这使 API 通用化，允许它灵活地与支持 GATT 的任何设备一起工作。

## Web NFC API

近场通信（NFC）允许设备在彼此靠近时交换信息。Web NFC API 将允许设备与 NFC 硬件交换消息和信息。

此 API 提供使用 NFC 数据交换格式（NDEF）交换消息的能力。这是 NFC 论坛发布的标准化格式。

## EyeDropper API

EyeDropper API 将允许您通过取色器工具从屏幕上的像素中选择颜色。此工具将在浏览器窗口内外都能工作，使您能够从屏幕上的任何位置选择颜色。

您可以通过调用`EyeDropper`构造函数来创建一个取色器。`EyeDropper`提供一个`open`方法，在屏幕上显示一个取色器界面，并返回一个`Promise`。一旦您使用取色器选择了像素，`Promise`将以所选像素的颜色解析。

## Barcode Detection API

此 API 将使您的应用程序能够读取条形码和 QR 码。它支持多种标准条形码类型。这将是一个多功能的 API，可以从许多不同的图像源读取条形码：图像和视频元素、Blob、画布元素等。

通过将图像数据传递给`BarcodeDetector`的`detect`方法来检测条形码。这将返回一个`Promise`，该`Promise`解析为关于检测到的任何条形码及其值的数据。

## Cookie Store API

当前在浏览器中使用 cookie 的机制并不是很方便。`document.cookie`属性是一个包含当前站点的 cookie 名称和值映射的单个字符串。

即将推出的 Cookie Store API 提供了一个异步、更健壮的接口，用于访问 cookie 信息。您可以使用`CookieStore.get`方法查找单个 cookie 的详细信息，该方法返回一个`Promise`，解析为具有给定名称的 cookie 的信息。

它还允许您监听`change`事件，该事件在 cookie 数据更改时触发。

## Payment APIs

支付请求 API 提供了一种在浏览器中启动支付的方式。然后，您可以使用 Payment Handler API 处理支付，而无需重定向到另一个网站。

这将使您在使用外部支付处理器时提供更一致的体验。

## 寻找下一个步骤

网络世界一直在变化。如果你想了解其他网页浏览器 API 的即将到来的情况，一些好的资源包括：

+   [MDN Web 文档](https://oreil.ly/PqBPh)有一个[Web API 页面](https://oreil.ly/YTWkO)，展示当前和即将推出或实验性 API 的概述。

+   [W3C 标准和草案页面](https://oreil.ly/Xu47E)包含一个可搜索的标准和各个开发阶段草案规范的目录。
