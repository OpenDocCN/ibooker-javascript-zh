# 第二章：API 介绍

想象一下自己坐在一家小而地道的餐馆的包厢里，你决定点一份三明治。服务员在一张纸条上写下你的订单并递给厨师。厨师读取订单，逐个取材料来制作三明治，然后将三明治交给服务员。服务员再把三明治端到你面前。如果你想要甜点，过程会重复。

应用程序编程接口（API）是一组规范，允许一个计算机程序与另一个进行交互。Web API 的工作方式类似于订购三明治。客户端请求一些数据，该数据通过超文本传输协议（HTTP）传输到 Web 服务器应用程序，Web 服务器应用程序接收请求并处理数据，然后通过 HTTP 将数据发送给客户端。

在本章中，我们将探讨 Web API 的广泛主题，并通过克隆初始 API 项目到我们的本地机器来开始开发。然而，在此之前，让我们先探索一下我们将要构建的应用程序的要求。

# 我们正在构建什么

在整本书中，我们将构建一个名为 Notedly 的社交笔记应用程序。用户可以创建账户，在普通文本或 Markdown 中编写笔记，编辑他们的笔记，查看其他用户笔记的动态，以及“收藏”其他用户的笔记。在本书的这一部分中，我们将开发支持该应用程序的 API。

在我们的 API 中：

+   用户可以创建笔记，以及阅读、更新和删除他们创建的笔记。

+   用户可以查看其他用户创建的笔记动态，并阅读其他人创建的单个笔记，但不能更新或删除它们。

+   用户可以创建账户，登录和登出。

+   用户可以检索他们的个人资料信息，以及其他用户的公开个人资料信息。

+   用户可以收藏其他用户的笔记，并检索他们收藏的列表。

# Markdown

Markdown 是一种流行的文本标记语言，广泛应用于编程社区以及诸如 iA Writer、Ulysses、Byword 等文本应用程序中。要了解更多关于 Markdown 的信息，请访问[Markdown Guide 网站](https://www.markdownguide.org)。

尽管听起来有点复杂，但我将在本书的这一部分中逐步解释。一旦你学会执行这些类型的交互，你就能够应用它们来构建各种类型的 API。

# 我们如何构建这个应用程序

为了构建我们的 API，我们将使用 [GraphQL API 查询语言](https://graphql.org)。GraphQL 是一个开源规范，最初于 2012 年在 Facebook 开发。GraphQL 的优势在于允许客户端精确请求需要的数据，显著简化和限制请求的数量。当我们向移动客户端发送数据时，这也提供了明显的性能优势，因为我们只需发送客户端需要的数据。在本书的大部分内容中，我们将探讨如何编写、开发和消费 GraphQL API。

# REST 是怎样的呢？

如果你熟悉 Web API 的术语，你可能听说过 REST（表述性状态转移）API。REST 架构一直（并将继续）是 API 的主流格式。这些 API 通过依赖 URL 结构和查询参数向服务器发送请求。尽管 REST 仍然重要，但 GraphQL 的简单性、围绕 GraphQL 的强大工具以及通过网络发送有限数据的潜在性能优势使得 GraphQL 成为我在现代平台上的首选。

# 入门

在我们开始开发之前，我们需要将项目的起始文件复制到我们的机器上。项目的 [源代码](https://oreil.ly/mYKmE) 包含了我们开发应用程序所需的所有脚本和第三方库的引用。要将代码克隆到本地机器上，请打开终端，导航到你项目保存的目录，**`git clone`** 项目仓库，并使用 **`npm install`** 安装依赖项。创建一个 *notedly* 目录以保持书籍所有代码的组织也可能很有帮助：

```
$ cd Projects
$ mkdir notedly && cd notedly
$ git clone git@github.com:javascripteverywhere/api.git
$ cd api
$ npm install
```

# 安装第三方依赖

通过复制书中的起始代码，并在目录中运行 `npm install`，你避免了需要为每个独立的第三方依赖再次运行 `npm install`。

代码结构如下：

/src

这是你在跟随书籍开发时应该进行开发的目录。

/解决方案

这个目录包含每个章节的解决方案。如果遇到困难，你可以查阅这些内容。

/最终版

这个目录包含最终的工作项目。

现在你已经将代码下载到本地机器上，你需要复制项目的 *.env* 文件。这个文件用于保存环境相关信息或项目机密，比如数据库 URL、客户端 ID 和密码。因此，你绝对不应该将其提交到源代码控制中。你需要自己复制一份 *.env* 文件。在 *api* 目录下，输入以下命令到终端：

```
cp .env.example .env
```

现在你应该在目录中看到一个 *.env* 文件。目前你不需要对此文件做任何操作，但随着我们在开发 API 后端的过程中，我们将逐步向其添加信息。项目附带的 *.gitignore* 文件将确保你不会意外提交 *.env* 文件。

# 帮助，我找不到 .env 文件！

默认情况下，操作系统会隐藏以点开头的文件，因为这些文件通常由系统而非用户使用。如果您看不到 *.env* 文件，请尝试在文本编辑器中打开该目录。该文件应该会在编辑器的文件浏览器中可见。或者，您可以在终端窗口中输入 `ls -a` 来列出当前工作目录中的文件。

# 结论

API 提供了一个从数据库流向应用程序的接口。通过这种方式，它们是现代应用程序的支柱。使用 GraphQL，我们可以快速开发现代化、可扩展的基于 API 的应用程序。在下一章中，我们将通过使用 Node.js 和 Express 构建一个 Web 服务器来开始我们的 API 开发。
