# 前言

你能读到这句话的唯一方法是打开这本书，无论是实体书还是电子书。这告诉我你对 TypeScript 很感兴趣，这是近年来最流行的编程语言之一。根据[2022 年 JavaScript 状况调查](https://2022.stateofjs.com)，几乎 70%的参与者在积极使用 TypeScript。[2022 年 StackOverflow 调查](https://survey.stackoverflow.co/2022)将 TypeScript 列为五大最受欢迎语言之一，用户满意度排名第四。到 2023 年初，TypeScript 每周在 NPM 上的下载量超过了 4000 万次。

毫无疑问：TypeScript 是一种现象！

尽管 TypeScript 很受欢迎，但仍然让很多开发者感到困扰。*与类型检查器抗争*是一个经常听到的说法；另一个是*随便加几个`any`来让它闭嘴*。有些人感到自己写代码只是为了取悦编译器，即使他们知道他们的代码*必须*工作。然而，TypeScript 的唯一目的是让 JavaScript 开发者更加高效和有效率。这个工具最终是未能实现其目标，还是我们作为开发者对这个工具的期望与其设计目标不同？

答案就在中间，这就是*TypeScript 食谱*的用武之地。在这本书中，你将找到 100 多个配方，涵盖从复杂项目设置到高级类型技术的所有内容。你将了解类型系统的复杂性和内部运作方式，以及它不得不做出的权衡和异常，以不干扰其基础：JavaScript。你还将学习方法论、设计模式和开发技术，以创建更好、更健壮的 TypeScript 代码。最终，你将不仅明白*如何*做某事，还将明白*为什么*。

我的目标是为你提供一本指南，从初学者到专家，以及在你阅读完本书后可以长期使用的快速参考。由于 TypeScript 每年有四次发布，不可能在一本书中列出所有最新的功能。这就是为什么我们专注于编程语言的持久方面，为你准备所有即将到来的变化。欢迎来到 TypeScript 食谱。

# 这本书适合谁？

这本书适合那些已经掌握足够 JavaScript 知识，并初步涉足 TypeScript 的开发者、工程师和架构师。你理解类型的基本概念及其应用方式，也知道静态类型的即时优势。你现在正处于一个有趣的阶段：你需要更深入地了解类型系统，并且需要积极地与 TypeScript 合作，不仅确保应用程序稳健且可扩展，还要确保与同事之间的协作。

你希望了解在 TypeScript 中某些内容的行为方式，并理解其背后的原因。这正是你在 *TypeScript Cookbook* 中可以得到的。你将学习项目设置、怪癖及类型系统的行为，复杂类型及其用例，以及与框架的协作和应用类型开发方法论。本书旨在将你从初学者引导至专家。如果你需要一个指南来积极学习 TypeScript 的高级特性，并且希望这本书能成为你职业生涯中的可靠参考，那么这本书将不会让你失望。

# 本书内容包括：

《TypeScript Cookbook》撰写的一个主要目标是解决日常问题的解决方案。TypeScript 是一门卓越的编程语言，其类型系统的特性非常强大，以至于我们达到了一个人们挑战自己使用高级 [TypeScript puzzles](https://tsch.js.org) 的阶段。尽管这些脑筋急转弯很有趣，但它们通常缺乏真实世界的背景，因此不属于本书的内容。

我希望确保所呈现的内容是作为 TypeScript 开发人员在日常工作中会遇到的问题，这些问题源自真实世界的情况，并提供了整体性的解决方案。我将教会你在多种场景下可以使用的技术和方法论，而不仅仅是单一的配方。在整本书中，你会发现对先前配方的引用，展示了特定技术如何在新的上下文中应用。

示例要么直接摘自真实项目源代码，要么被简化到只展示概念本质而不需要太多领域知识。尽管有些示例非常具体，你也会看到很多 `Person` 对象，这些对象的名称是“Stefan”（你将能够看到我在整本书中的年龄变化）。

本书几乎专注于 TypeScript 在 JavaScript 基础上增加的特性；因此，要完全理解示例，你需要掌握相当数量的 JavaScript。我不指望你成为 JavaScript 大师，但至少要能阅读基本的 JavaScript 代码。由于 JavaScript 和 TypeScript 之间存在密切关系，本书的一些章节讨论 JavaScript 的特性及其行为，但始终从 TypeScript 的视角出发。

Cookbook 的设计旨在为您的问题提供快速解决方案：一种配方。在本书中，每个配方都以 *discussion* 结尾，为您提供更广泛的上下文和解决方案的含义。根据作者的风格，O'Reilly 的 Cookbook 聚焦于解决方案或讨论。*TypeScript Cookbook* 显然是一本 *discussion* 书籍。在我近 20 年的软件编写生涯中，我从未遇到一种解决方案适用于所有问题的情况。这就是为什么我想详细展示我们是如何得出结论、它们的含义以及权衡的原因。最终，这本书应该是像这样的讨论指南。当你需要作出明智的决策时，为什么要凭空猜测呢？

# 本书的组织方式

*TypeScript Cookbook* 从头到尾带你了解这门语言。我们从项目设置开始，讨论基本类型和类型系统的内部工作原理，最终进入条件类型和辅助类型等高级领域。我们继续探讨探索非常特定功能的章节，例如类的二元性和对 React 的支持，并最终学习如何最好地处理类型开发。

虽然有一个主线和逐步发展，但每一章和每个配方都可以单独消化。每一课都设计为指出与书中前后（或下一！）配方的关联，但每一章最终都是独立的。可以从头到尾阅读，也可以根据“选择你自己的冒险”方法及其众多参考进行使用。以下是内容的简要概述。

TypeScript 希望能够与所有类型的 JavaScript 兼容，而这些类型多种多样。在 第一章，“项目设置” 中，你将学习不同语言运行时、模块系统和目标平台的配置选项。

第二章，“基本类型” 将引导你了解类型层次结构，告诉你 `any` 和 `unknown` 的区别，教你哪些代码属于哪个命名空间，并回答关于选择类型别名还是接口描述对象类型的古老问题。

本书中较长的一章是 第三章，“类型系统”。在这里，你将学习关于联合类型和交集类型的一切，如何定义辨识联合类型，如何使用 *assert never* 和 *optional never* 技术，以及根据用例如何缩小和扩大类型。在这章之后，你将理解为什么 TypeScript 使用类型断言而不是类型转换，为什么枚举通常不被看好，以及如何在结构类型系统中找到名义位。

TypeScript 拥有一个通用类型系统，我们将在第四章，“泛型”中详细介绍它。泛型不仅使你的代码更具重用性，还是进入 TypeScript 更高级特性的入口。这一章标志着你从 TypeScript 基础进入到类型系统更复杂领域的时刻，是第一部分的合适结尾。

第五章，“条件类型”解释了为什么 TypeScript 类型系统也是其自身的元编程语言。通过基于特定条件选择类型的可能性，人们发明了一些杰出的东西，比如一个完整的 SQL 解析器或者类型系统中的字典。我们使用条件类型作为工具，使静态类型系统在动态情况下更加灵活。

在第六章，“字符串模板字面类型”中，你将看到 TypeScript 如何在类型系统中集成字符串解析器。从格式字符串中提取名称，基于字符串输入定义动态事件系统，并动态创建标识符：似乎没有什么是不可能的！

你将在第七章，“可变元组类型”中略尝*函数式编程*的味道。在 TypeScript 中，*元组*具有特殊含义，帮助描述函数参数和类似数组的对象，并创建灵活的辅助函数。

更多元编程发生在第八章，“辅助类型”中。TypeScript 有几个内置辅助类型，使你更容易从其他类型推导出类型。在这一章中，你不仅学习如何使用它们，还学习如何创建自己的辅助类型。这一章也标志着*TypeScript Cookbook*的下一个断点，因为此时你已经学会了语言和类型系统的所有基本要素，可以在接下来的部分中应用它们。

在了解了类型系统所有细枝末节的八章之后，现在是时候在第九章，“标准库和外部类型定义”中将你的知识与他人完成的类型定义集成起来了。在本章中，你将看到一些与预期不同的工作情况，并了解如何弯曲内置类型定义以符合你的意愿。

在第十章，“TypeScript 与 React”中，你将学习如何将最流行的 JavaScript 框架之一集成到 TypeScript 中，使语法扩展*JSX*成为可能，并了解这如何融入 TypeScript 的整体概念。你还将学习如何为组件和钩子编写健壮的类型，并处理附加到实际库后的类型定义文件。

下一章讨论的是类，这是面向对象编程的一个支柱，在 JavaScript 之前的 TypeScript 中就已经存在。这导致了一个特性的有趣二元性，详细讨论在第十一章，“类”中。

书末以 第十二章，“类型开发策略” 结束。在这里，我专注于赋予你自主创建高级类型的技能，帮助你做出项目推进的正确决策，并处理那些为你验证类型的库。你还将了解特殊的解决方法和隐藏功能，并讨论如何命名泛型，或者高级类型是否有些超出预期。这一章特别有趣，因为在从新手到学徒的漫长旅程后，你将达到专家的地步。

所有示例都可以在 TypeScript Playground 或 CodeSandbox 项目中找到，访问 [书籍网站](https://typescript-cookbook.com)。Playground 特别提供了一个中间状态，让你可以自己摸索和测试行为。我总是说，你不能仅靠阅读来学会编程语言；你需要积极编码，动手实践，才能理解所有元素是如何相互作用的。把这看作是一个邀请，去享受编程类型的乐趣。

# 本书使用的约定

## 编程约定

TypeScript 支持多种编程风格和格式选项。为了避免*琐碎讨论*，我选择使用 [Prettier](https://prettier.io) 自动格式化所有示例。如果你习惯于不同的格式风格——也许你更喜欢在类型的每个属性声明后使用逗号而不是分号——你完全可以继续使用你喜欢的方式。

*TypeScript Cookbook* 涵盖了大量示例，并涉及许多函数。编写函数有很多方法，我选择主要使用*函数声明*而不是*函数表达式*，除非在需要解释两者差异时关键。在其他所有情况下，这主要是一种口味选择，而不是技术原因。

所有示例均已根据 TypeScript 5.0 进行了检查，这是书写本书时的最新版本。TypeScript 不断变化，规则也在变化。本书确保我们主要关注那些长期可靠的内容，并可以跨版本信赖。在我预期会有进一步发展或根本性变化的地方，我会提供相应的警告和说明。

## 排版约定

本书使用以下排版约定：

*斜体*

表示新术语、网址、电子邮件地址、文件名和文件扩展名。

`等宽字体`

用于程序列表，以及在段落内引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字。

*`等宽斜体`*

显示应由用户提供值或由上下文确定值替换的文本。

###### 提示

此元素表示提示或建议。

###### 注意

此元素表示一般说明。

###### 警告

此元素表示警告或注意事项。

# 使用代码示例

补充材料（代码示例、练习等）可在[*https://typescript-cookbook.com*](https://typescript-cookbook.com)下载。

如果您有技术问题或在使用代码示例时遇到问题，请发送电子邮件至*support@oreilly.com*。

本书旨在帮助您完成工作。一般情况下，如果本书提供示例代码，您可以在程序和文档中使用它。除非您复制了代码的大部分内容，否则无需征得我们的许可。例如，编写一个使用本书多个代码块的程序不需要许可。销售或分发来自 O’Reilly 书籍的示例代码需要许可。引用本书并引用示例代码回答问题无需许可。将本书中大量示例代码整合到产品文档中需要许可。

我们感谢但不要求署名。署名通常包括标题、作者、出版商和 ISBN。例如：“*TypeScript Cookbook* by Stefan Baumgartner (O’Reilly). Copyright 2023 Stefan Baumgartner, 978-1-098-13665-9.”

如果您认为您对代码示例的使用超出了合理使用范围或上述许可，请随时与我们联系：*permissions@oreilly.com*。

# O’Reilly 在线学习

###### 注意

40 多年来，[*O’Reilly Media*](https://oreilly.com)提供技术和商业培训、知识和见解，帮助公司取得成功。

我们独特的专家和创新者网络通过书籍、文章和我们的在线学习平台分享他们的知识和专业知识。O’Reilly 的在线学习平台为您提供按需访问的实时培训课程、深入学习路径、交互式编码环境，以及来自 O’Reilly 和 200 多家其他出版商的大量文本和视频。欲了解更多信息，请访问[*https://oreilly.com*](https://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题发送给出版商：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   加利福尼亚州，塞巴斯托波尔，95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

+   *support@oreilly.com*

+   [*https://www.oreilly.com/about/contact.html*](https://www.oreilly.com/about/contact.html)

我们为这本书制作了一个网页，列出勘误、示例和任何其他信息。您可以访问[*https://oreil.ly/typescript-cookbook*](https://oreil.ly/typescript-cookbook)。

欲了解关于我们书籍和课程的最新消息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)。

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)。

在 YouTube 观看我们：[*https://youtube.com/oreillymedia*](https://youtube.com/oreillymedia)

# 致谢

Alexander Rosemann、Sebastian Gierlinger、Dominik Angerer 和 Georg Kothmeier 是我在有新计划时首先寻求意见的人。我们定期的会议和互动不仅令人愉快，而且为我提供了评估所有选择所需的必要反馈。他们是第一个听到这本书的人，也是第一个给予反馈的人。

在社交媒体上与 Matt Pocock、Joe Previte、Dan Vanderkam、Nathan Shively-Sanders 和 Josh Goldberg 的互动带来了许多新的想法。他们对 TypeScript 的方法可能与我的不同，但最终他们扩展了我的视野，并确保我不会过于固执己见。

Phil Nash、Simona Cotin 和 Vanessa Böhner 不仅是最终手稿的早期审阅者，还是长期以来一直在这里审视我的想法的伙伴和朋友。Addy Osmani 在我整个职业生涯中一直是我的灵感来源，我为他同意为我的新书撰写开篇感到非常自豪。

Lena Matscheko、Alexandra Rapeanu 和 Mike Kuss 毫不犹豫地向我提出基于他们真实经验的技术挑战和问题。在我缺少良好示例的时候，他们给我提供了大量优秀的源材料来提炼。

如果不是 Peter Kröner，我可能会错过 TypeScript 的所有新发展。每当有新的 TypeScript 版本发布时，他总是第一个找到我。我们在 TypeScript 发布上的一起播客已经成为传奇，尽管内容也越来越不只是关于 TypeScript。

我的技术编辑 Mark Halpin、Fabian Friedl 和 Bernhard Mayr 给予了我最好的技术反馈。他们质疑每一个假设，检查每一个代码示例，确保我的所有推理都是有意义的，而且没有遗漏。他们对细节的热爱和他们在高水平上讨论的能力，确保了这本书不仅仅是一堆热门观点的集合，而是一个建立在坚实基础上的指南和参考书。

如果没有 Amanda Quinn，这本书根本不会存在。在 2020 年编写了《TypeScript in 50 Lessons》之后，我以为我已经说尽了我对 TypeScript 的所有看法。是 Amanda 劝我试试写一本食谱书，看看我会发现哪些想法在第一本书中无法体现。三个小时后，我有了完整的提案和超过一百个条目的目录。Amanda 是对的：我还有很多话要说，我永远感激她的支持和指导。

Amanda 在项目早期阶段提供了帮助，Shira Evans 确保项目顺利进行，避免了任何偏离轨道的情况。她的反馈是无价的，她务实而且亲自动手的方法让合作变得非常愉快。

Elizabeth Faerm 和 Theresa Jones 负责制作。他们对细节的把握非常出色，确保制作阶段既令人兴奋，又实际上非常有趣！最终的结果是一次美好的体验，让我欲罢不能。

在写作过程中，我得到了 Porcupine Tree、Beck、植松伸夫、Camel、The Beta Band 以及许多其他人的巨大帮助。

这本书最大的贡献来自于我的家人。Doris、Clemens 和 Aaron 是我梦寐以求的一切，没有他们无尽的爱和支持，我将无法追求我的抱负。谢谢你们的一切。
